<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>STRIDE threat modeling on Kubernetes pt.1/6: Spoofing | Maxgio's blog</title><meta name=keywords content="kubernetes,security"><meta name=description content="As it comes from the power of the open source and Borg, Kubernetes is an ecosystem very flexible. Only the extensibility of the APIs as for the CRDs opens the world to a vastity of opportunities to build architectures upon it (see the SIG&rsquo;s Cluster API, the AWS EKS and Fargate combinations, etc.).
At the same time can be complex to manage, and everyone - or almost everyone - knows that is not enough to get applications working; as part of the administration it is vital to secure your cluster and so your application with your data to get the job done."><meta name=author content><link rel=canonical href=https://blog.maxgio.me/posts/k8s-stride-01-spoofing/><link crossorigin=anonymous href=/assets/css/stylesheet.min.149ea7cdaa83f0ab31471ced9e0495af0272de908dd4a38e5c229d8b0579a758.css integrity="sha256-FJ6nzaqD8KsxRxztngSVrwJy3pCN1KOOXCKdiwV5p1g=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><link rel=icon href=https://blog.maxgio.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.maxgio.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.maxgio.me/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.maxgio.me/apple-touch-icon.png><link rel=mask-icon href=https://blog.maxgio.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-7DN0LVS78Q','auto');ga('send','pageview');}</script><meta property="og:title" content="STRIDE threat modeling on Kubernetes pt.1/6: Spoofing"><meta property="og:description" content="As it comes from the power of the open source and Borg, Kubernetes is an ecosystem very flexible. Only the extensibility of the APIs as for the CRDs opens the world to a vastity of opportunities to build architectures upon it (see the SIG&rsquo;s Cluster API, the AWS EKS and Fargate combinations, etc.).
At the same time can be complex to manage, and everyone - or almost everyone - knows that is not enough to get applications working; as part of the administration it is vital to secure your cluster and so your application with your data to get the job done."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.maxgio.me/posts/k8s-stride-01-spoofing/"><meta property="og:image" content="https://blog.maxgio.me/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-02-03T18:36:15+02:00"><meta property="article:modified_time" content="2020-02-03T18:36:15+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.maxgio.me/papermod-cover.png"><meta name=twitter:title content="STRIDE threat modeling on Kubernetes pt.1/6: Spoofing"><meta name=twitter:description content="As it comes from the power of the open source and Borg, Kubernetes is an ecosystem very flexible. Only the extensibility of the APIs as for the CRDs opens the world to a vastity of opportunities to build architectures upon it (see the SIG&rsquo;s Cluster API, the AWS EKS and Fargate combinations, etc.).
At the same time can be complex to manage, and everyone - or almost everyone - knows that is not enough to get applications working; as part of the administration it is vital to secure your cluster and so your application with your data to get the job done."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.maxgio.me/posts/"},{"@type":"ListItem","position":2,"name":"STRIDE threat modeling on Kubernetes pt.1/6: Spoofing","item":"https://blog.maxgio.me/posts/k8s-stride-01-spoofing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"STRIDE threat modeling on Kubernetes pt.1/6: Spoofing","name":"STRIDE threat modeling on Kubernetes pt.1\/6: Spoofing","description":"As it comes from the power of the open source and Borg, Kubernetes is an ecosystem very flexible. Only the extensibility of the APIs as for the CRDs opens the world to a vastity of opportunities to build architectures upon it (see the SIG\u0026rsquo;s Cluster API, the AWS EKS and Fargate combinations, etc.).\nAt the same time can be complex to manage, and everyone - or almost everyone - knows that is not enough to get applications working; as part of the administration it is vital to secure your cluster and so your application with your data to get the job done.","keywords":["kubernetes","security"],"articleBody":"As it comes from the power of the open source and Borg, Kubernetes is an ecosystem very flexible. Only the extensibility of the APIs as for the CRDs opens the world to a vastity of opportunities to build architectures upon it (see the SIG’s Cluster API, the AWS EKS and Fargate combinations, etc.).\nAt the same time can be complex to manage, and everyone - or almost everyone - knows that is not enough to get applications working; as part of the administration it is vital to secure your cluster and so your application with your data to get the job done.\nIn security, the threat modeling is the process of identifying vulnerabilities to improve security by preventing the threats introduced by vulnerabilities.\nIn turn, there are different types of threats and the STRIDE model defines 6 categories of them:\n Spoofing Tampering Repudiation Information disclosure Denial of service Elevation of privilege  In this series of short and concise guide for threat prevention on Kubernetes, we’ll go through each category of threat starting with the first one.\nSpoofing Spoofing is pretending to be somebody or something you are not, to gain extra privileges. The process that makes sure the presented identity is real is the authentication, and in Kubernetes the authentication is based on mutual TLS.\nWe briefly analyze the situation from the API Server perspective and the Pod perspective.\nAPI Server Starting with the API Server, the mTLS is only as secure as the Certificate Authority, so:\n The CA must be secured, so in particular: the certificates issued by the CA must be used and trusted only within the cluster; outside of Kubernetes the CA should not be trusted. Use two key pairs, one for internal components and one for external components, in particular: use self-signed CA for internal keys; third-party CA(s) for external components' certificates; in this case Kubernetes must be configured to trust it/them.  Pod On the pod perspective, mostly it probably does not need to access the API Server, in which case:\n since pods use Service Account to authenticate to the API server and be authorized by mounting the Service Account token as a Secret, don’t mount it on Pods by default. In particular, with Kubernetes 1.6+, specifying it at the Pod level with the automountServiceAccountToken spec:  apiVersion:v1kind:Podmetadata:name:my-podspec:serviceAccountName:build-robotautomountServiceAccountToken:falseYou can configure it also at the Service Account level; keep in mind that the Pod Spec takes precedence over the Service Account if both specify a automountServiceAccountToken value.\nThis is the end of the first pill of this series. Stay tuned for the next part.\nHappy hacking!\n","wordCount":"428","inLanguage":"en","datePublished":"2020-02-03T18:36:15+02:00","dateModified":"2020-02-03T18:36:15+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.maxgio.me/posts/k8s-stride-01-spoofing/"},"publisher":{"@type":"Organization","name":"Maxgio's blog","logo":{"@type":"ImageObject","url":"https://blog.maxgio.me/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=https://blog.maxgio.me/ accesskey=h title="Maxgio's blog (Alt + H)">Maxgio's blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.maxgio.me/posts title=Posts><span>Posts</span></a></li><li><a href=https://blog.maxgio.me/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.maxgio.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://github.com/maxgio92 title=Github><span>Github</span></a></li><li><a href=https://hachyderm.io/@maxgio92 title=Mastodon><span>Mastodon</span></a></li><li><a href=https://twitter.com/maxgio92 title=Twitter><span>Twitter</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.maxgio.me/>Home</a>&nbsp;»&nbsp;<a href=https://blog.maxgio.me/posts/>Posts</a></div><h1 class=post-title>STRIDE threat modeling on Kubernetes pt.1/6: Spoofing</h1><div class=post-meta><span title="2020-02-03 18:36:15 +0200 +0200">February 3, 2020</span>&nbsp;·&nbsp;3 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#spoofing aria-label=Spoofing>Spoofing</a><ul><li><a href=#api-server aria-label="API Server">API Server</a></li><li><a href=#pod aria-label=Pod>Pod</a></li></ul></li></ul></div></details></div><div class=post-content><p>As it comes from the power of the open source and Borg, Kubernetes is an ecosystem very flexible. Only the extensibility of the APIs as for the CRDs opens the world to a vastity of opportunities to build architectures upon it (see the SIG&rsquo;s Cluster API, the AWS EKS and Fargate combinations, etc.).</p><p>At the same time can be complex to manage, and everyone - or almost everyone - knows that is not enough to get applications working; as part of the administration it is vital to secure your cluster and so your application with your data to get the job done.</p><p>In security, the threat modeling is the process of identifying vulnerabilities to improve security by preventing the threats introduced by vulnerabilities.</p><p>In turn, there are different types of threats and the STRIDE model defines 6 categories of them:</p><ul><li>Spoofing</li><li>Tampering</li><li>Repudiation</li><li>Information disclosure</li><li>Denial of service</li><li>Elevation of privilege</li></ul><p>In this series of short and concise guide for threat prevention on Kubernetes, we&rsquo;ll go through each category of threat starting with the first one.</p><h1 id=spoofing>Spoofing<a hidden class=anchor aria-hidden=true href=#spoofing>#</a></h1><p>Spoofing is pretending to be somebody or something you are not, to gain extra privileges. The process that makes sure the presented identity is real is the authentication, and in Kubernetes the authentication is based on mutual TLS.</p><p>We briefly analyze the situation from the API Server perspective and the Pod perspective.</p><h2 id=api-server>API Server<a hidden class=anchor aria-hidden=true href=#api-server>#</a></h2><p>Starting with the API Server, the mTLS is only as secure as the Certificate Authority, so:</p><ul><li>The CA must be secured, so in particular:</li><li>the certificates issued by the CA must be used and trusted only within the cluster;
outside of Kubernetes the CA should not be trusted.</li><li>Use two key pairs, one for internal components and one for external components, in particular:</li><li>use self-signed CA for internal keys;</li><li>third-party CA(s) for external components' certificates; in this case Kubernetes must be configured to trust it/them.</li></ul><h2 id=pod>Pod<a hidden class=anchor aria-hidden=true href=#pod>#</a></h2><p>On the pod perspective, mostly it probably does not need to access the API Server, in which case:</p><ul><li>since pods use Service Account to authenticate to the API server and be authorized by mounting the Service Account token as a Secret, don&rsquo;t mount it on Pods by default. In particular, with Kubernetes 1.6+, specifying it at the Pod level with the automountServiceAccountToken spec:</li></ul><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-pod</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>build-robot</span><span class=w>
</span><span class=w>  </span><span class=nt>automountServiceAccountToken</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></code></pre></div><p>You can configure it also at the Service Account level; keep in mind that the Pod Spec takes precedence over the Service Account if both specify a automountServiceAccountToken value.</p><p>This is the end of the first pill of this series. Stay tuned for the next part.</p><p>Happy hacking!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.maxgio.me/tags/kubernetes/>kubernetes</a></li><li><a href=https://blog.maxgio.me/tags/security/>security</a></li></ul><nav class=paginav><a class=prev href=https://blog.maxgio.me/posts/k8s-stride-02-tampering/><span class=title>« Prev</span><br><span>STRIDE threat modeling on Kubernetes pt.2/6: Tampering</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share STRIDE threat modeling on Kubernetes pt.1/6: Spoofing on twitter" href="https://twitter.com/intent/tweet/?text=STRIDE%20threat%20modeling%20on%20Kubernetes%20pt.1%2f6%3a%20Spoofing&url=https%3a%2f%2fblog.maxgio.me%2fposts%2fk8s-stride-01-spoofing%2f&hashtags=kubernetes%2csecurity"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zm-253.927 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share STRIDE threat modeling on Kubernetes pt.1/6: Spoofing on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.maxgio.me%2fposts%2fk8s-stride-01-spoofing%2f&title=STRIDE%20threat%20modeling%20on%20Kubernetes%20pt.1%2f6%3a%20Spoofing&summary=STRIDE%20threat%20modeling%20on%20Kubernetes%20pt.1%2f6%3a%20Spoofing&source=https%3a%2f%2fblog.maxgio.me%2fposts%2fk8s-stride-01-spoofing%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512h-386.892c-34.524.0-62.554-28.03-62.554-62.554v-386.892c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0v-129.439c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02v-126.056c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768h75.024zm-307.552-334.556c-25.674.0-42.448 16.879-42.448 39.002.0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.maxgio.me/>Maxgio's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerHTML='copy';function copyingDone(){copybutton.innerHTML='copied!';setTimeout(()=>{copybutton.innerHTML='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>